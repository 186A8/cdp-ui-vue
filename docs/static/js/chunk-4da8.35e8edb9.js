(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4da8"],{"8Pae":function(e,i,t){"use strict";var s=t("AR/1");t.n(s).a},"AR/1":function(e,i,t){},DQzz:function(e,i,t){"use strict";t.r(i);var s=t("QbLZ"),n=t.n(s),r=t("L2JU"),o={name:"GrantPermission",data:function(){return{parent:{},form:{},title:"分配权限",expandKeys:[],checkedKeys:[],dialogPermissionVisible:!1,hackReset:!1,permissionId:"-1",defaultProps:{children:"children",label:"name",isLeaf:"leaf",disabled:"disabled"},filterPermissionText:""}},computed:n()({},Object(r.b)(["permissions"])),watch:{filterPermissionText:function(e){this.$refs.permissionTree.filter(e)}},methods:{hasPermission:function(e){if(!e||"string"!=typeof e)throw new Error("need permission! Like \"'1'\"");var i=this.permissions[e]||!1;return!!i},filterNode:function(e,i){return!e||-1!==i.name.indexOf(e)},updatePermession:function(e,i){var t=this,s=this.$refs.permissionTree.getCheckedKeys().sort(),n=this.$refs.permissionTree.getHalfCheckedKeys().sort(),r=this.checkedKeys.sort(),o=this.expandKeys.sort(),a=s.concat(n.filter(function(e){return-1===s.indexOf(e)})).sort(),c=r.filter(function(e){return-1===o.indexOf(e)}),l=c.concat(a.filter(function(e){return-1===c.indexOf(e)})).sort();l.toString()!==r.toString()?this.parent.updatePermession(e,l).then(function(){t.dialogPermissionVisible=!1,t.$notify({title:"成功",message:"修改权限成功!",type:"success",duration:2e3})}).catch(function(e){t.$notify({title:"更新权限失败",message:e.message,type:"error",duration:5e3})}):this.dialogPermissionVisible=!1},getCheckedKeys:function(e){var i=[];if(!e||e.length<1)return i;for(var t=0;t<e.length;t++)i.push(e[t].permissionId);return i},initData:function(e,i,t,s,n){var r=this;this.parent=e,this.form=i,this.permissionId=s,this.checkedKeys=this.getCheckedKeys(t),this.$refs&&this.$refs.permissionTree&&this.$refs.permissionTree.setCheckedKeys(this.checkedKeys),this.dialogPermissionVisible=!0,n?(this.hackReset=!1,this.$nextTick(function(){r.hackReset=!0})):this.hackReset=!0,this.title="分配权限 -> "+i.name},cancel:function(){this.dialogPermissionVisible=!1},loadChildPermissions:function(e,i){var t=this,s=0;0!==e.level&&(s=e.data.id),this.parent.listChildPermissions(s).then(function(e){for(var s=e.data||[],n=0;n<s.length;n++){var r=s[n].id;t.expandKeys.push(r)}return i(s)}).catch(function(e){t.$notify({title:"加载子节点失败",message:e.message,type:"error",duration:5e3})})},close:function(){this.parent={},this.form={},this.checkedKeys=[],this.title="",this.expandKeys=[],this.dialogPermissionVisible=!1}}},a=(t("8Pae"),t("KHd+")),c=Object(a.a)(o,function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("el-dialog",{attrs:{title:e.title,visible:e.dialogPermissionVisible,width:"550px"},on:{"update:visible":function(i){e.dialogPermissionVisible=i},close:e.close}},[t("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterPermissionText,callback:function(i){e.filterPermissionText=i},expression:"filterPermissionText"}}),e._v(" "),e.hackReset?t("el-tree",{ref:"permissionTree",staticClass:"filter-tree",attrs:{"default-checked-keys":e.checkedKeys,load:e.loadChildPermissions,props:e.defaultProps,"filter-node-method":e.filterNode,"default-expanded-keys":[1],"node-key":"id","highlight-current":"","show-checkbox":"",lazy:"","check-strictly":""}}):e._e(),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{round:"",icon:"el-icon-circle-close"},on:{click:function(i){e.cancel()}}},[e._v(e._s(e.$t("table.cancel"))+"\n    ")]),e._v(" "),e.hasPermission(e.permissionId)?t("el-button",{attrs:{round:"",type:"primary",icon:"el-icon-circle-check"},on:{click:function(i){e.updatePermession(e.form.id)}}},[e._v("\n      "+e._s(e.$t("table.update"))+"\n    ")]):e._e()],1)],1)},[],!1,null,"1a73b1d3",null);c.options.__file="grantPermission.vue";i.default=c.exports}}]);