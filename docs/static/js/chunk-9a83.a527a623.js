(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9a83"],{"8WsT":function(e,t,a){"use strict";a.d(t,"h",function(){return n}),a.d(t,"e",function(){return i}),a.d(t,"d",function(){return o}),a.d(t,"f",function(){return s}),a.d(t,"b",function(){return l}),a.d(t,"a",function(){return c}),a.d(t,"g",function(){return d}),a.d(t,"c",function(){return m});var r=a("t3Un");function n(e){return Object(r.a)({url:"/platform/v1/organiz/tree/"+e,method:"post"})}function i(e){return Object(r.a)({url:"/platform/v1/organiz/listChild/"+e,method:"post"})}function o(e){return Object(r.a)({url:"/platform/v1/organiz/listAllChild/"+e,method:"post"})}function s(e){return Object(r.a)({url:"/platform/v1/organiz/",method:"post",data:e})}function l(e,t){return Object(r.a)({url:"/platform/v1/organiz/"+e,method:t||"post"})}function c(e){return Object(r.a)({url:"/platform/v1/organiz/"+e,method:"delete"})}function d(e){return Object(r.a)({url:"/platform/v1/organiz",method:"put",data:e})}function m(e,t){return Object(r.a)({url:"/platform/v1/organiz/auth/"+e,method:t||"post"})}},WX1J:function(e,t,a){"use strict";a.r(t);var r=a("QbLZ"),n=a.n(r),i=a("8WsT"),o=a("L2JU"),s={name:"SystemOrganiz",data:function(){var e=this;return{parent:{code:"",name:""},list:null,total:null,formUpdate:!0,hackReset:!0,formStatus:"",listQuery:{name:void 0},topId:-1,rules:{name:[{required:!0,message:"机构名称不能为空",trigger:"blur"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"blur"}],code:[{required:!0,message:"机构编码不能为空",trigger:"blur"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"blur"},{validator:function(t,a,r){a.substring(0,e.parent.code.length)!==e.parent.code&&r(new Error("机构编码必须以父机构编码为前缀!")),a===e.parent.code&&r(new Error("机构编码不能和父机构编码相同!")),r()},trigger:"blur"}],topId:[{required:!0,message:"顶级机构编码不能为空",trigger:"blur"}],pid:[{required:!0,message:"父机构不能为空",trigger:"blur"}]},treeData:[],defaultExpandedKeys:[1],defaultProps:{children:"children",label:"name",isLeaf:"leaf"},labelPosition:"right",form:{}}},computed:n()({},Object(o.b)(["userInfo"])),mounted:function(){this.resetForm()},methods:{loadChild:function(e,t){var a=this;if(0===e.level){var r=this.userInfo.organizId;0===r?Object(i.e)(r).then(function(e){return a.defaultExpandedKeys[0]=e.data[0].id,t(e.data||[])}).catch(function(e){a.$notify({title:"加载子节点失败",message:e.message,type:"error",duration:5e3})}):Object(i.b)(r).then(function(e){var n=[];return n.push(e.data),a.defaultExpandedKeys[0]=r,t(n||[])}).catch(function(e){a.$notify({title:"加载子节点失败",message:e.message,type:"error",duration:5e3})})}else Object(i.e)(e.data.id).then(function(e){return t(e.data||[])}).catch(function(e){a.$notify({title:"加载子节点失败",message:e.message,type:"error",duration:5e3})})},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},getOrganizData:function(e){var t=void 0;return this.$refs&&this.$refs.organizTree&&(t=this.$refs.organizTree.getNode(e)),t?t.data:{id:e,name:e}},getOrganizName:function(e){return this.getOrganizData(e).name},getNodeData:function(e){var t=this;if(e.id!==this.form.id){this.formUpdate||(this.formStatus="update"),Object(i.b)(e.id).then(function(e){t.form=e.data,t.form.status=t.form.status+""}).catch(function(e){t.$notify({title:"获取机构失败",message:e.message,type:"error",duration:5e3})});var a=this.$refs.organizTree.getNode(e.pid);a?this.parent=a.data:(this.parent=e,this.formStatus="",this.formUpdate=!0)}},handlerRefresh:function(){var e=this;this.hackReset=!1,this.$nextTick(function(){e.hackReset=!0})},handlerUpdate:function(){this.$refs.organizTree.getNode(this.form.pid)?this.form.id&&(this.formUpdate=!1,this.formStatus="update"):this.$message({message:"根节点不能修改"})},handlerAdd:function(){this.form.id?0!==this.form.type?(this.parent=this.form,this.resetForm(),this.formUpdate=!1,this.formStatus="create"):this.$message({message:"按钮下不能再新增子节点"}):this.$message({message:"请选择一个父节点再新增子节点"})},handleDelete:function(){var e=this;if(this.form&&this.form.id){var t=this.$refs.organizTree.getNode(this.form.id);t&&t.childNodes&&t.childNodes.length>0?this.$message({message:"该节点还存在子节点不能直接删除!"}):this.$confirm("此操作将永久删除机构[ "+this.form.name+" ], 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(i.a)(e.form.id).then(function(){e.$refs.organizTree.remove(e.form.id),e.resetForm(),e.onCancel(),e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3})}).catch(function(t){e.$notify({title:"删除机构失败",message:t.message,type:"error",duration:5e3})})}).catch(function(e){})}else this.$message({message:"请先选择一个要删除的节点!"})},update:function(){var e=this;Object(i.g)(this.form).then(function(t){var a=e.$refs.organizTree.getNode(e.form.id);a&&(a.data=t.data),e.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})}).catch(function(t){e.$notify({title:"更新机构失败",message:t.message,type:"error",duration:5e3})})},create:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;Object(i.f)(e.form).then(function(t){var a=e.$refs.organizTree.getNode(e.form.pid);e.$refs.organizTree.append(t.data,a),a.data.children=null,e.resetForm(),e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})}).catch(function(t){e.$notify({title:"创建机构失败",message:t.message,type:"error",duration:5e3})})})},onCancel:function(){this.formUpdate=!0,this.formStatus=""},resetForm:function(){this.form={address:void 0,code:this.parent.code,phone:void 0,name:this.parent.name,fullname:this.parent.fullname,id:void 0,splitId:void 0,pid:this.parent.id,topId:this.form.topId,status:"0",level:(this.parent&&this.parent.level?this.parent.level:0)+1}}}},l=a("KHd+"),c=Object(l.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container calendar-list-container"},[a("div",{staticClass:"filter-container"},[a("el-button-group",[a("el-button",{directives:[{name:"waves",rawName:"v-waves"},{name:"permission",rawName:"v-permission",value:"86",expression:"'86'"}],staticClass:"filter-item",attrs:{round:"",type:"primary",icon:"el-icon-refresh"},on:{click:e.handlerRefresh}},[e._v(e._s(e.$t("table.refresh")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"},{name:"permission",rawName:"v-permission",value:"4",expression:"'4'"}],staticClass:"filter-item",staticStyle:{"margin-left":"5px"},attrs:{round:"",type:"primary",icon:"el-icon-circle-plus"},on:{click:e.handlerAdd}},[e._v(e._s(e.$t("table.add")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"},{name:"permission",rawName:"v-permission",value:"5",expression:"'5'"}],staticClass:"filter-item",staticStyle:{"margin-left":"5px"},attrs:{round:"",type:"success",icon:"el-icon-edit"},on:{click:e.handlerUpdate}},[e._v(e._s(e.$t("table.edit")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"},{name:"permission",rawName:"v-permission",value:"6",expression:"'6'"}],staticClass:"filter-item",staticStyle:{"margin-left":"5px"},attrs:{round:"",type:"danger",icon:"el-icon-delete"},on:{click:e.handleDelete}},[e._v(e._s(e.$t("table.delete")))])],1)],1),e._v(" "),a("el-row",[a("el-col",{staticStyle:{"margin-top":"15px"},attrs:{span:8}},[e.hackReset?a("el-tree",{ref:"organizTree",staticClass:"filter-tree",attrs:{load:e.loadChild,"default-expanded-keys":e.defaultExpandedKeys,"filter-node-method":e.filterNode,props:e.defaultProps,"node-key":"id","highlight-current":"",lazy:""},on:{"node-click":e.getNodeData}}):e._e()],1),e._v(" "),a("el-col",{staticStyle:{"margin-top":"15px"},attrs:{span:16}},[a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"form",attrs:{"label-position":e.labelPosition,rules:e.rules,model:e.form,"label-width":"120px"}},["update"===e.formStatus?a("el-form-item",[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{round:"",icon:"el-icon-circle-close"},on:{click:e.onCancel}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{round:"",type:"primary",icon:"el-icon-circle-check"},on:{click:e.update}},[e._v(e._s(e.$t("table.update")))])],1):e._e(),e._v(" "),"create"===e.formStatus?a("el-form-item",[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{round:"",icon:"el-icon-circle-close"},on:{click:e.onCancel}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{round:"",type:"primary",icon:"el-icon-circle-check"},on:{click:e.create}},[e._v(e._s(e.$t("table.create")))])],1):e._e(),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("cdp_organization.topId.label"),prop:"topId"}},[a("el-tag",[e._v(e._s(e.getOrganizName(e.form.topId)))])],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("cdp_organization.pId.label"),prop:"pid"}},[a("el-tag",[e._v(e._s(e.parent.code+" - "+e.parent.name))])],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("cdp_organization.code.label"),prop:"code"}},[a("el-input",{attrs:{disabled:e.formUpdate,placeholder:e.$t("cdp_organization.code.placeholder")},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("cdp_organization.name.label"),prop:"name"}},[a("el-input",{attrs:{disabled:e.formUpdate,placeholder:e.$t("cdp_organization.name.placeholder")},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("cdp_organization.fullname.label"),prop:"fullname"}},[a("el-input",{attrs:{disabled:e.formUpdate,placeholder:e.$t("cdp_organization.fullname.placeholder")},model:{value:e.form.fullname,callback:function(t){e.$set(e.form,"fullname",t)},expression:"form.fullname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("cdp_organization.address.label"),prop:"address"}},[a("el-input",{attrs:{disabled:e.formUpdate,placeholder:e.$t("cdp_organization.address.placeholder")},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("cdp_organization.telphone.label"),prop:"telphone"}},[a("el-input",{attrs:{disabled:e.formUpdate,placeholder:e.$t("cdp_organization.telphone.placeholder")},model:{value:e.form.telphone,callback:function(t){e.$set(e.form,"telphone",t)},expression:"form.telphone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("cdp_organization.status.label"),prop:"status"}},[a("el-switch",{attrs:{disabled:e.formUpdate,"active-color":"#13ce66","inactive-color":"#ff4949","active-value":"0","inactive-value":"1"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1)],1)],1)],1)],1)},[],!1,null,null,null);c.options.__file="index.vue";t.default=c.exports}}]);